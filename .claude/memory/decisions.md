# 意思決定記録 - freee-partner-refiner

## 概要

このファイルはプロジェクトの重要な意思決定を記録します。

---

## 2026-01-04: アーキテクチャ変更 - セマンティック企業マッチング

### 背景

当初は文字列クリーニング（「トイザラス熊本店」→「トイザラス熊本」）で法人検索していたが、
これでは親会社の特定ができない。

### 決定事項

**セマンティック企業マッチング方式**を採用:

1. 銀行/カード明細の取引先名から**親会社を特定**（Web検索 + AI解析）
2. freeeの**既存取引先とマッチング**
3. マッチすれば紐付け、なければ新規作成を提案

### 処理フロー

```
入力: 銀行/カード明細 "トイザラス熊本店"
        ↓
Step 1: Web検索「トイザラス 熊本県 会社名 法人」
        ↓
Step 2: AI解析 → "株式会社トイザラス" を特定
        ↓
Step 3: freee既存取引先を取得
        ↓
Step 4: 類似度マッチング
        ├─ マッチあり → 既存取引先に紐付け提案
        └─ マッチなし → gBizINFOで法人番号取得 → 新規作成提案
        ↓
出力: 紐付け提案 or 新規取引先作成提案
```

### 理由

- インボイス制度対応のため、正確な法人番号が必要
- 店舗名（トイザラス熊本店）と法人名（株式会社トイザラス）は異なる
- 既存のfreee取引先を活用し、重複を防ぐ

### 影響

- コア処理ロジックの全面的な再設計が必要
- Web検索API（またはClaude API）が追加で必要
- 類似度マッチングロジックの実装が必要

---

## 2026-01-04: プロジェクトセットアップ

### 決定事項

- **開発モード**: Solo モード（Claude Code のみ）
- **ワークフロー**: Plans.md ベースのタスク管理

### 理由

- 個人プロジェクトのため、シンプルなワークフローが適切

---

## テンプレート

```markdown
## YYYY-MM-DD: [決定タイトル]

### 決定事項

- [何を決めたか]

### 選択肢

1. [選択肢A] - [メリット/デメリット]
2. [選択肢B] - [メリット/デメリット]

### 理由

- [なぜその選択をしたか]

### 影響

- [この決定が影響する範囲]
```
